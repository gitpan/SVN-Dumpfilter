#!/usr/bin/perl -w
# $Id$
# Copyright (C) 2006 by Martin Scharrer <martin@scharrer-online.de>
# This is free software under the GPL.

use strict;
use FileHandle;

use vars qw($nl $cr);
use subs qw();

BEGIN {
$nl = chr(10);
$cr = chr(13);
}

my @files = @ARGV;

foreach my $file (@files)
 {
   next unless -T $file;
   print "Processing file '$file'\n";
   
   my $newfile = "$file.new";
   if (-e $newfile)
    {
      print "Skipping existing new file '$newfile'.\n";
      next;
    }
   
   my (undef, undef, undef, undef, undef, undef, undef, undef, $atime, $mtime,
     undef, undef, undef) = stat($file);
 
   open (IN,  '<', $file)    or do { warn "Couldn't open infile to read\n"; next; };
   open (OUT, '>', $newfile) or do { warn "Couldn't open outfile to write\n"; next; };

   while (my $line = <IN>)
    {
      $line =~ s/$cr?$nl$//o;
      print OUT $line . $nl;
    }

   close (IN);
   close (OUT);
   
   rename($newfile, $file) || warn;
   utime ($atime, $mtime, $file);
   system("svn propset 'svn:eol-style' 'native' $file");
 }


exit(0);
__END__

# Vim setting modeline - please do not delete
# vim: tabstop=2 expandtab autoindent

